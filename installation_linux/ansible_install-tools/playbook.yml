---
- name: Automatisation des installations
  hosts: all
  become: true

  tasks:
    - name: Fail if not an x86_64 architecture
      ansible.builtin.fail:
        msg: "This playbook is intended only for x86_64 (amd64) architectures."
      when: ansible_architecture != "x86_64"

    - name: Update and upgrade all packages to the latest version
      ansible.builtin.apt:
        update_cache: true
        upgrade: dist
        cache_valid_time: 3600

    - name: Install required packages
      ansible.builtin.apt:
        pkg:
          - apt-transport-https
          - ca-certificates
          - gnupg
          - software-properties-common
          - build-essential
          - zip
          - curl
          - wget
          - git
          - unzip
          - hstr
          - xclip
          - vim
          - terminator
          - pandoc
          - lynx

    - name: Cloner le dépôt Git
      git:
        repo: 'https://github.com/aGrellard/utilitaires_linux.git'
        dest: '/tmp/utilitaires_linux'
        clone: yes
        update: no

    - name: Donner les droits d'exécution au script
      file:
        path: '/tmp/utilitaires_linux/installation_linux/scripts/installation_paquets.sh'
        mode: '0755'
        state: file

    - name: Exécuter le script
      command: '/tmp/utilitaires_linux/installation_linux/scripts/installation_paquets.sh'
      args:
        chdir: '/tmp/utilitaires_linux/installation_linux/scripts'


  post_tasks:
    - name: Message de fin d'installation
      debug:
        msg: "Tout est installé ! Veuillez vous déconnecter et vous reconnecter pour utiliser zsh."
